# 东方财富股票公告下载器

这是一个用于爬取东方财富网站股票公告的Python爬虫程序，支持自动下载PDF格式的公告文件并按类型分类存储。

## 功能特点

- 🔍 **智能爬取**：自动获取指定股票的公告列表
- 📁 **分类存储**：按公告类型自动创建文件夹并分类保存
- 📄 **PDF下载**：自动下载公告PDF文件，支持断点续传和重试机制
- 🛡️ **反爬虫**：内置请求头和延迟机制，避免被网站封禁
- ⚙️ **配置灵活**：通过配置文件轻松修改股票代码和公告类型
- 🔄 **完整性验证**：下载后自动验证文件大小，确保下载完整

## 文件结构

```
East_money_stock_notice_download/
├── main.py              # 主程序文件，爬虫核心逻辑
├── config.json          # 配置文件，设置股票代码和公告类型
├── test.py              # 测试文件，用于功能测试
├── readme.md            # 说明文档
└── {股票简称}pdf/       # PDF存储目录，按公告类型分类
    ├── 定期报告/
    ├── 业绩预告/
    ├── 重大事项/
    └── ...
```

## 环境要求

- Python 3.6+
- 操作系统：Windows/Linux/macOS
- 网络连接：需要访问东方财富网站

### 依赖包

程序使用以下Python标准库，无需额外安装：
- `os` - 文件和目录操作
- `re` - 正则表达式
- `json` - JSON数据处理
- `time` - 时间处理
- `requests` - HTTP请求
- `urllib.parse` - URL解析
- `sys` - 系统相关
- `subprocess` - 子进程管理

### 系统要求

- **Windows用户**：需要安装curl命令（通常Windows 10已预装）
- **Linux/macOS用户**：curl通常已预装

## 快速开始

### 1. 配置设置

编辑 `config.json` 文件：

```json
{
    "stock_code": "600519",
    "f_node": "0",
    "s_node": "0"
}
```

### 2. 运行程序

```bash
python main.py
```

### 3. 查看结果

程序运行完成后，PDF文件将保存在以股票简称命名的文件夹中，按公告类型分类。

## 配置说明

### config.json 参数详解

| 配置项      | 说明         | 示例值   | 默认值 |
| ----------- | ------------ | -------- | ------ |
| stock_code  | 股票代码     | 600519   | 601225 |
| f_node      | 公告大类     | 0        | 1      |
| s_node      | 公告小类     | 0        | 1      |

### 公告类型配置

#### 公告大类 (f_node)

| f_node值 | 含义     | 说明 |
|----------|----------|------|
| 0        | 全部     | 下载所有类型的公告 |
| 1        | 财务报告 | 包含定期报告、业绩预告等 |
| 2        | 融资公告 | 新股发行、增发、配股等 |
| 3        | 风险提示 | 各类风险提示公告 |
| 4        | 信息变更 | 公司信息变更公告 |
| 5        | 重大事项 | 重大合同、投资、股权激励等 |
| 6        | 资产重组 | 要约收购、吸收合并、回购等 |
| 7        | 持股变动 | 股东持股变动公告 |

#### 公告小类 (s_node)

公告小类与公告大类配对使用：

| f_node值 | s_node值 | 含义       | 说明 |
|----------|----------|------------|------|
| 0        | 0        | 全部       | 下载所有公告 |
| 1        | 1        | 定期报告   | 年报、季报、半年报 |
| 1        | 5        | 业绩预告   | 业绩预告公告 |
| 1        | 6        | 业绩快报   | 业绩快报公告 |
| 1        | 13       | 利润分配   | 分红派息公告 |
| 2        | 2        | 新股发行   | 首次公开发行 |
| 2        | 3        | 增发       | 定向增发、公开增发 |
| 2        | 4        | 配股       | 配股公告 |
| 5        | 7        | 重大合同   | 重大合同签署 |
| 5        | 8        | 投资相关   | 对外投资、收购等 |
| 5        | 9        | 股权激励   | 股权激励计划 |
| 6        | 10       | 要约收购   | 要约收购公告 |
| 6        | 11       | 吸收合并   | 吸收合并公告 |
| 6        | 12       | 回购       | 股份回购公告 |

## 使用示例

### 下载贵州茅台全部公告

```json
{
    "stock_code": "600519",
    "f_node": "0",
    "s_node": "0"
}
```

### 下载特定类型公告

```json
{
    "stock_code": "000001",
    "f_node": "1",
    "s_node": "1"
}
```

## 程序特性

### 智能文件命名

程序会自动生成规范的文件名：
- 格式：`{股票代码}{股票简称}{公告标题}{日期}.pdf`
- 自动去除特殊字符，只保留中文、数字、字母
- 避免文件名过长或包含非法字符

### 下载重试机制

- 最多重试3次
- 自动验证文件大小完整性
- 文件大小不符时自动重新下载
- 每次重试间隔1秒

### 反爬虫措施

- 随机User-Agent
- 请求间隔延迟（1-2秒）
- 分页处理，避免一次性请求过多数据

## 错误处理

程序包含完善的错误处理机制：

- **网络错误**：自动重试，最多3次
- **文件下载失败**：验证文件大小，不完整时重新下载
- **解析错误**：跳过错误数据，继续处理其他公告
- **目录创建失败**：自动创建必要的文件夹结构

## 注意事项

1. **网络环境**：确保网络连接稳定，能够访问东方财富网站
2. **存储空间**：确保有足够的磁盘空间存储PDF文件
3. **下载速度**：程序设置了合理的延迟，避免对目标网站造成压力
4. **文件覆盖**：同名文件会被覆盖，请注意备份重要文件
5. **使用频率**：建议不要过于频繁地运行程序，避免被网站限制

## 技术支持

如遇到问题，请检查：

1. 网络连接是否正常
2. 配置文件格式是否正确
3. Python环境是否满足要求
4. curl命令是否可用（Windows用户）

## 更新日志

- **v1.0**：基础功能实现，支持公告下载和分类存储
- 支持多种公告类型配置
- 内置反爬虫和重试机制
- 智能文件命名和完整性验证
